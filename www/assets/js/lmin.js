function checkIshanzi(a){var b=/[^\x00-\x80]/;return b.exec(a)?!0:!1}function checkIsRegisterUserName(a){var b=/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){3,19}$/;return b.exec(a)?!0:!1}function checkIsTrueName(a){var b=/^[a-zA-Z]{4,30}$/;return b.exec(a)?!0:!1}function checkIsPasswd(a){var b=/^[a-z0-9_-]{6,19}$/;return b.exec(a)?!0:!1}function checkIsTel(a){var b=/^[+]{0,1}(d){1,4}[ ]?([-]?((d)|[ ]){1,12})+$/;return b.exec(a)?!0:!1}function checkIsMobil(a){var b=/^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/;return b.exec(a)?!0:!1}function checkIsPostalCode(a){var b=/^[a-zA-Z0-9 ]{3,12}$/;return b.exec(a)?!0:!1}function checkIsIP(a){var b=/^[0-9.]{1,20}$/;return b.exec(a)?!0:!1}function checkIsEMail(a){var b=/^([0-9A-Za-z\-_\.]+)@([0-9A-Za-z]+\.[A-Za-z]{2,3}(\.[A-Za-z]{2})?)$/g;return b.exec(a)?!0:!1}function checkIsNickName(a){var b=/^[\u4e00-\u9fa5a-zA-Z]{3,8}$/;return b.exec(a)?!0:!1}function enc(a){return $.md5(a+$("#date").val()+a.substr(1,3))}function getCookie(a){var b=document.cookie.match("\\b"+a+"=([^;]*)\\b");return b?b[1]:void 0}function getQueryStr(a){var b=window.location.search,c=new RegExp(""+a+"=([^&?]*)","ig");return b.match(c)?b.match(c)[0].substr(a.length+1):null}jQuery.postJSON=function(a,b,c,d){b._xsrf=getCookie("_xsrf"),$.ajax({url:a,timeout:1e3,data:$.param(b),dataType:"json",type:"POST",success:function(a){c(a)},error:function(){d()}})};var Login={title:null,loginui:null,ing:!1,name:null,createUI:function(a){var b,c;title=$("<div>").addClass("title").html("冒险者大陆").appendTo(a),loginui=$("<div>").addClass("center-block").addClass("col-xs-6").addClass("col-md-4").attr("id","logindiv").appendTo(a),$("<div>").attr("id","form_signin").appendTo("#logindiv"),b="",b="<div class='signTitle'><a id='nav_signup'>注册</a><a id='nav_signin'>登录</a></div>",b+="<div id='singnwrapper'><div class='input-wrapper' id='usernamewrapper'>",b+="<input type='text' id='username' class='form-control' placeholder='登录名' required autofocus></div> ",b+="<div class='input-wrapper' id='pwdwrapper'>",b+="<input type='password' id='inputPassword' class='form-control' placeholder='密码' required></div>",b+="<button class='btn btn-lg btn-primary btn-block' id='signinBtn' >登录</button><div class='errormsg' id='signinerror'></div></div>",b+="<div id='regwrapper'><div class='input-wrapper' id='susernamewrapper'>",b+="<input type='text' id='susername' class='form-control' placeholder='登录名' required autofocus></div> ",b+="<div class='input-wrapper' id='snicknamewrapper'>",b+="<input type='text' id='snickname' class='form-control' placeholder='游戏昵称' required autofocus></div>",b+="<div class='input-wrapper' id='spwdwrapper'>",b+="<input type='password' id='sinputPassword' class='form-control' placeholder='密码' required></div>",b+="<div class='input-wrapper' id='srpwdwrapper'><input type='password' id='repeatPassword' class='form-control' placeholder='重复密码' required></div>",b+="<button class='btn btn-lg btn-primary btn-block' id='signupBtn' >注册</button><div class='errormsg' id='signuperror'></div></div>",$("#form_signin").html(b),$("#signinBtn").click(Login.onClickSignin),$("#signupBtn").click(Login.onClickSignup),$("#nav_signup").click(Login.onClickSignupNav),$("#nav_signin").click(Login.onClickSigninNav),$("#inputPassword").focus(function(){Login.delError("#pwdwrapper"),$("#inputPassword").val(""),Login.clearError("#signinerror")}),$("#username").focus(function(){Login.delError("#usernamewrapper"),$("#username").val(""),Login.clearError("#signinerror")}),$("#susername").focus(function(){Login.delError("#susernamewrapper"),$("#susername").val(""),Login.clearError("#signuperror")}),$("#snickname").focus(function(){Login.delError("#snicknamewrapper"),$("#snickname").val(""),Login.clearError("#signuperror")}),$("#sinputPassword").focus(function(){Login.delError("#spwdwrapper"),$("#sinputPassword").val(""),Login.clearError("#signuperror")}),$("#repeatPassword").focus(function(){Login.delError("#srpwdwrapper"),$("#repeatPassword").val(""),Login.clearError("#signuperror")}),Login.onClickSigninNav(),c=getQueryStr("user"),void 0!=c&&$("#username").val(c)},onClickSignupNav:function(){$("#singnwrapper").hide(),$("#regwrapper").show(),$("#nav_signup").addClass("active"),$("#nav_signin").removeClass("active")},onClickSigninNav:function(){$("#regwrapper").hide(),$("#singnwrapper").show(),$("#nav_signin").addClass("active"),$("#nav_signup").removeClass("active")},removeUI:function(){loginui.remove(),title.remove()},printError:function(a,b){$(a).html(b)},clearError:function(a){$(a).html("")},addError:function(a,b){0==$(a+">label.error").length?$("<label>").addClass("error").html(b).appendTo(a):$(a+">label.error").html(b),Login.printError("用户名密码不正确")},delError:function(a){$(a+">label.error").remove(),Login.clearError()},onSignError:function(){},onClickSignup:function(){var a,b,c,d,e,f,g,h,i;if(!Login.ing){if(a=$("#susername").val(),b=$("#snickname").val(),c=$("#sinputPassword").val(),d=$("#repeatPassword").val(),e=checkIsRegisterUserName(a),f=checkIsNickName(b),g=checkIsPasswd(c),h=c==d,e||Login.addError("#susernamewrapper","用户名为4-20位英文数字"),f||Login.addError("#snicknamewrapper","昵称为3-8位中文英文"),g||Login.addError("#spwdwrapper","密码为6-20位英文数字"),h||Login.addError("#srpwdwrapper","2次密码不一致"),c=enc(c),void 0==c)return Notif.print("密码出现undefined错误"),void 0;Login.name=a,e&&g&&h&&f&&(Login.ing=!0,i={session:document.session,action:"signup",name:a,pwd:c,nick:b},jQuery.postJSON("./login",i,Login.onSignupBack,Login.onSignError))}},onSignupBack:function(a){Login.ing=!1;var b=parseInt(a.sta);0!=b?-3==b?Login.printError("#signuperror","用户名或密码为空,请重新输入!"):-4==b?Login.printError("#signuperror","用户名已被占用，请换个名字"):-5==b?Login.printError("#signuperror","昵称已被占用，请换个名字"):-99==b?Login.printError("#signuperror","服务器忙"):Login.printError("#signuperror","发生未知错误"):(alert("注册成功，请登录！"),window.location.href="/login?user="+Login.name)},onClickSignin:function(){var a,b,c,d,e;if(!Login.ing)return a=$("#username").val(),b=$("#inputPassword").val(),c=checkIsRegisterUserName(a),d=checkIsPasswd(b),c||Login.addError("#usernamewrapper","用户名为4-20位英文数字"),d||Login.addError("#pwdwrapper","密码为6-20位英文数字"),b=enc(b),void 0==b?(Notif.print("密码出现undefined错误"),void 0):(c&&d&&(Login.ing=!0,e={session:document.session,action:"signin",name:a,pwd:b},jQuery.postJSON("./login",e,Login.onSigninBack,Login.onSignError)),void 0)},onSignError:function(){Login.ing=!1,alert("error")},onSigninBack:function(a){Login.ing=!1;var b=parseInt(a.sta);0!=b?-2==b?Login.printError("#signinerror","无此用户，请先注册！"):-3==b?Login.printError("#signinerror","用户名或密码为空,请重新输入!"):-5==b?Login.printError("#signinerror","用户名或密码不正确！"):Login.printError("#signinerror","发生未知错误"):window.location.href="/"}};$(function(){Login.createUI("div#box")});