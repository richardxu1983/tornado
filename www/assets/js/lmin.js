function checkIshanzi(r){var n=/[^\x00-\x80]/
return n.exec(r)?!0:!1}function checkIsRegisterUserName(r){var n=/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){3,19}$/
return n.exec(r)?!0:!1}function checkIsTrueName(r){var n=/^[a-zA-Z]{4,30}$/
return n.exec(r)?!0:!1}function checkIsPasswd(r){var n=/^[a-z0-9_-]{6,19}$/
return n.exec(r)?!0:!1}function checkIsTel(r){var n=/^[+]{0,1}(d){1,4}[ ]?([-]?((d)|[ ]){1,12})+$/
return n.exec(r)?!0:!1}function checkIsMobil(r){var n=/^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/
return n.exec(r)?!0:!1}function checkIsPostalCode(r){var n=/^[a-zA-Z0-9 ]{3,12}$/
return n.exec(r)?!0:!1}function checkIsIP(r){var n=/^[0-9.]{1,20}$/
return n.exec(r)?!0:!1}function checkIsEMail(r){var n=/^([0-9A-Za-z\-_\.]+)@([0-9A-Za-z]+\.[A-Za-z]{2,3}(\.[A-Za-z]{2})?)$/g
return n.exec(r)?!0:!1}function checkIsNickName(r){var n=/^[\u4e00-\u9fa5a-zA-Z]{3,8}$/
return n.exec(r)?!0:!1}function enc(r){return $.md5(r+$("#date").val()+r.substr(1,3))}function getCookie(r){var n=document.cookie.match("\\b"+r+"=([^;]*)\\b")
return n?n[1]:void 0}jQuery.postJSON=function(r,n,i,e){n._xsrf=getCookie("_xsrf"),$.ajax({url:r,timeout:1e3,data:$.param(n),dataType:"json",type:"POST",success:function(r){i(r)},error:function(){e()}})}
var Login={title:null,loginui:null,ing:!1,createUI:function(r){title=$("<div>").addClass("title").html("冒险者大陆").appendTo(r),loginui=$("<div>").addClass("center-block").addClass("col-xs-6").addClass("col-md-4").attr("id","logindiv").appendTo(r),$("<div>").attr("id","form_signin").appendTo("#logindiv")
var n=""
n="<div class='signTitle'><a id='nav_signup'>注册</a><a id='nav_signin'>登录</a></div>",n+="<div id='singnwrapper'><div class='input-wrapper' id='usernamewrapper'>",n+="<input type='text' id='username' class='form-control' placeholder='登录名' required autofocus></div> ",n+="<div class='input-wrapper' id='pwdwrapper'>",n+="<input type='password' id='inputPassword' class='form-control' placeholder='密码' required></div>",n+="<button class='btn btn-lg btn-primary btn-block' id='signinBtn' >登录</button><div class='errormsg' id='signinerror'></div></div>",n+="<div id='regwrapper'><div class='input-wrapper' id='susernamewrapper'>",n+="<input type='text' id='susername' class='form-control' placeholder='登录名' required autofocus></div> ",n+="<div class='input-wrapper' id='snicknamewrapper'>",n+="<input type='text' id='snickname' class='form-control' placeholder='游戏昵称' required autofocus></div>",n+="<div class='input-wrapper' id='spwdwrapper'>",n+="<input type='password' id='sinputPassword' class='form-control' placeholder='密码' required></div>",n+="<div class='input-wrapper' id='srpwdwrapper'><input type='password' id='repeatPassword' class='form-control' placeholder='重复密码' required></div>",n+="<button class='btn btn-lg btn-primary btn-block' id='signupBtn' >注册</button><div class='errormsg' id='signuperror'></div></div>",$("#form_signin").html(n),$("#signinBtn").click(Login.onClickSignin),$("#signupBtn").click(Login.onClickSignup),$("#nav_signup").click(Login.onClickSignupNav),$("#nav_signin").click(Login.onClickSigninNav),$("#inputPassword").focus(function(){Login.delError("#pwdwrapper"),$("#inputPassword").val(""),Login.clearError("#signinerror")}),$("#username").focus(function(){Login.delError("#usernamewrapper"),$("#username").val(""),Login.clearError("#signinerror")}),$("#susername").focus(function(){Login.delError("#susernamewrapper"),$("#susername").val(""),Login.clearError("#signuperror")}),$("#snickname").focus(function(){Login.delError("#snicknamewrapper"),$("#snickname").val(""),Login.clearError("#signuperror")}),$("#sinputPassword").focus(function(){Login.delError("#spwdwrapper"),$("#sinputPassword").val(""),Login.clearError("#signuperror")}),$("#repeatPassword").focus(function(){Login.delError("#srpwdwrapper"),$("#repeatPassword").val(""),Login.clearError("#signuperror")}),Login.onClickSigninNav()},onClickSignupNav:function(){$("#singnwrapper").hide(),$("#regwrapper").show(),$("#nav_signup").addClass("active"),$("#nav_signin").removeClass("active")},onClickSigninNav:function(){$("#regwrapper").hide(),$("#singnwrapper").show(),$("#nav_signin").addClass("active"),$("#nav_signup").removeClass("active")},removeUI:function(){loginui.remove(),title.remove()},printError:function(r,n){$(r).html(n)},clearError:function(r){$(r).html("")},addError:function(r,n){0==$(r+">label.error").length?$("<label>").addClass("error").html(n).appendTo(r):$(r+">label.error").html(n),Login.printError("用户名密码不正确")},delError:function(r){$(r+">label.error").remove(),Login.clearError()},onSignError:function(){},onClickSignup:function(){if(!Login.ing){var r=$("#susername").val(),n=$("#snickname").val(),i=$("#sinputPassword").val(),e=$("#repeatPassword").val(),o=checkIsRegisterUserName(r),a=checkIsNickName(n),s=checkIsPasswd(i),t=i==e
if(o||Login.addError("#susernamewrapper","用户名为4-20位英文数字"),a||Login.addError("#snicknamewrapper","昵称为3-8位中文英文"),s||Login.addError("#spwdwrapper","密码为6-20位英文数字"),t||Login.addError("#srpwdwrapper","2次密码不一致"),i=enc(i),void 0==i)return void Notif.print("密码出现undefined错误")
if(o&&s&&t&&a){Login.ing=!0
var c={session:document.session,action:"signup",name:r,pwd:i,nick:n}
jQuery.postJSON("./login",c,Login.onSignupBack,Login.onSignError)}}},onSignupBack:function(r){Login.ing=!1
var n=parseInt(r.sta)
0!=n?-3==n?Login.printError("#signuperror","用户名或密码为空,请重新输入!"):-4==n?Login.printError("#signuperror","用户名已被占用，请换个名字"):-5==n?Login.printError("#signuperror","昵称已被占用，请换个名字"):-99==n?Login.printError("#signuperror","服务器忙"):Login.printError("#signuperror","发生未知错误"):(alert("注册成功，请登录！"),window.location.href="/login")},onClickSignin:function(){if(!Login.ing){var r=$("#username").val(),n=$("#inputPassword").val(),i=checkIsRegisterUserName(r),e=checkIsPasswd(n)
if(i||Login.addError("#usernamewrapper","用户名为4-20位英文数字"),e||Login.addError("#pwdwrapper","密码为6-20位英文数字"),n=enc(n),void 0==n)return void Notif.print("密码出现undefined错误")
if(i&&e){Login.ing=!0
var o={session:document.session,action:"signin",name:r,pwd:n}
jQuery.postJSON("./login",o,Login.onSigninBack,Login.onSignError)}}},onSignError:function(){Login.ing=!1,alert("error")},onSigninBack:function(r){Login.ing=!1
var n=parseInt(r.sta)
0!=n?-2==n?Login.printError("#signinerror","无此用户，请先注册！"):-3==n?Login.printError("#signinerror","用户名或密码为空,请重新输入!"):-5==n?Login.printError("#signinerror","用户名或密码不正确！"):Login.printError("#signinerror","发生未知错误"):window.location.href="/"}}
$(function(){Login.createUI("div#box")})
